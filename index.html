<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Promille Rechner</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0a84ff">
  <style>
    :root{--bg:#f7f7f7;--card:#fff;--text:#111;--muted:#666;--primary:#0a84ff;--danger:#d9534f;--radius:14px}
    @media (prefers-color-scheme: dark){:root{--bg:#0b0b0b;--card:#1a1a1a;--text:#f2f2f2;--muted:#aaa}}
    html,body{height:100%}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;color:var(--text);background:var(--bg);
      padding:env(safe-area-inset-top) 12px calc(12px + env(safe-area-inset-bottom))}
    .wrap{max-width:720px;margin:0 auto}
    h1{font-size:1.4rem;margin:8px 4px 10px}
    .card{background:var(--card);border-radius:var(--radius);padding:14px;box-shadow:0 1px 2px rgba(0,0,0,.06);margin-bottom:12px}
    .row{display:flex;flex-wrap:wrap;gap:8px}
    label{display:inline-flex;align-items:center;gap:6px;margin:6px 8px 6px 0}
    input,select,button{font-size:1rem;padding:12px 14px;border-radius:12px;border:1px solid rgba(0,0,0,.1);background:#fff}
    @media (prefers-color-scheme: dark){input,select,button{background:#121212;border-color:rgba(255,255,255,.12);color:var(--text)}}
    button{background:var(--primary);border:none;color:#fff;min-height:44px}
    button.ghost{background:transparent;color:var(--text);border:1px solid rgba(0,0,0,.12)}
    #resetBtn{background:var(--danger)}
    .prom{font-size:1.8rem;font-weight:700;margin:10px 4px 6px}
    .muted{color:var(--muted)}
    .entry{margin-bottom:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Promille Rechner</h1>
    <div class="card">
      <div class="row">
        <label>Getr√§nk:
          <select id="drinkType">
            <option value="bier">Bier (5%)</option>
            <option value="radler">Radler (2.5%)</option>
          </select>
        </label>
        <label>Menge:
          <select id="drinkSize">
            <option value="0.3">0,3 L</option>
            <option value="0.4">0,4 L</option>
            <option value="0.5" selected>0,5 L</option>
          </select>
        </label>
      </div>
      <div class="row">
        <button id="addDrinkBtn">Jetzt getrunken</button>
        <button id="resetBtn" class="ghost">Zur√ºcksetzen</button>
      </div>
    </div>

    <div class="prom" id="promilleAnzeige">Aktuelle Promille: 0,00‚Ä∞</div>

    <div id="log" class="card">
      <b>Getrunkene Getr√§nke</b>
      <div class="muted" id="emptyMsg">Noch nichts erfasst.</div>
    </div>

    <div class="muted card">
      <small>Offline nutzbar: Diese App kann als PWA zum Home-Bildschirm hinzugef√ºgt werden.</small>
    </div>
  </div>

  <script>
    // PWA: Service Worker registrieren
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js');
      });
    }

    // Rechnen
    const gewicht=80, r=0.68, abbau=0.13;
    const nf = new Intl.NumberFormat('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    let drinks = JSON.parse(localStorage.getItem('drinks')||'[]').map(d=>({...d,t:new Date(d.t)}));

    function g(type,liter){ return liter * (type==='bier'?0.05:0.025) * 0.8 * 1000; }
    function prom(){
      const now = Date.now();
      let x=0;
      for(const d of drinks){
        const h = Math.max(0, (now - new Date(d.t)) / 36e5);
        const p = d.g / (gewicht*r) - h*abbau;
        x += Math.max(0, p);
      }
      return x;
    }
    function update(){
      document.getElementById('promilleAnzeige').textContent = 'Aktuelle Promille: ' + nf.format(prom()) + '‚Ä∞';
      const L = document.getElementById('log');
      const empty = document.getElementById('emptyMsg');
      L.querySelectorAll('.entry').forEach(e=>e.remove());
      if(!drinks.length){ empty.style.display='block'; return; }
      empty.style.display='none';
      for(const d of drinks){
        const t=new Date(d.t).toLocaleTimeString('de-DE',{hour:'2-digit',minute:'2-digit'});
        const div=document.createElement('div');
        div.className='entry';
        div.textContent = `üïí ${t}: ${nf.format(d.s)} L ${d.ty==='bier'?'Bier':'Radler'}`;
        L.appendChild(div);
      }
    }
    function addDrink(){
      const ty = document.getElementById('drinkType').value;
      const s = parseFloat(document.getElementById('drinkSize').value);
      drinks.push({ty:ty, s:s, g:g(ty,s), t:Date.now()});
      localStorage.setItem('drinks', JSON.stringify(drinks));
      update();
    }
    function resetAll(){ drinks=[]; localStorage.removeItem('drinks'); update(); }

    document.getElementById('addDrinkBtn').addEventListener('click', addDrink);
    document.getElementById('resetBtn').addEventListener('click', resetAll);
    setInterval(update, 30000);
    update();
  </script>
</body>
</html>
